<?php
/**
 * @file
*
* Test case for Ncbi with selenium
*/
if(!class_exists('DrupalSeleniumWebTestCase')){
  drupal_set_message(t('Selenium tests are not displayed because the selenium module is not enabled.'), 'warning', FALSE);
  return;
}

class NcbiSeleniumTestCase extends ScratchpadsTweaksSeleniumTestCase{

  public static function getInfo(){
    return array(
      'name' => 'Ncbi (Selenium)',
      'description' => 'Tests for Ncbi',
      'group' => 'Scratchpads',
      'browsers' => array(
        'firefox'
      )
    );
  }

  /**
   * A wrapper for the following:
   * - Create animal vocabulary
   * - Import taxonomy from EOL.('Pediculus')
   * - Enable NCBI on the tools page
   * - Verify that the ncbi information shows up on the taxonomy page, under descriptions
   * 
   */
  function testWrapper(){
    $this->drupalLogin($this->maintainer);
    $vocab_name = $this->randomName();
    $term_name = 'Pediculus';
    // Create animal vocabulary
    $this->createAnimalVocabulary($vocab_name);
    // Import taxonomy from EOL.
    $success = $this->importTaxonomy($vocab_name, $term_name);
    if($success){
      // Enable NCBI on the tools page
      $this->enableNcbiTool();
      // Verify that the ncbi information shows up on the taxonomy page, under descriptions
      $this->verifyNcbi($vocab_name, $term_name);     
    }
  }

 
  function enableNcbiTool(){
    $this->drupalGet('admin/structure/tools');
    $this->driver->getElement('css=.form-item-status-ncbi .iphone_switch_container img')->click();
    // Wait 1 second, then submit the form
    $this->driver->sleep(1);
    $this->driver->getElement("id=edit-submit")->click();
    $this->assertText('The configuration options have been saved.', 'Confirmation message shown when enabling tool.');
  }
  
  function verifyNcbi($vocab_name, $term_name){
    $this->drupalGet('');
    $this->clickLink($vocab_name);
    $this->driver->waitForElements("xpath=//*[text()[contains(.," . $term_name . ")]]");
    $this->clickLink('Descriptions');
    $this->driver->waitForElements("xpath=//*[text()[contains(.,'NCBI')]]");
    $this->assertText('NCBI', 'NCBI header text present on on desriptions tab of taxonomy page');
    $this->assertText('Database name', 'NCBI table present on desriptions tab of taxonomy page');
    
  }
  
  /**
   * Create a vocabulary
   */
  function createAnimalVocabulary($vocab_name){
    $this->drupalGet('admin/structure/taxonomy/add');
    $this->driver->waitForElements("name=name");
    $element = $this->driver->getElement("name=name");
    $element->clear();
    $element->sendKeys($vocab_name);
    $element = $this->driver->getElement("name=description");
    $element->clear();
    $element->sendKeys($this->randomName());
    $element = $this->driver->getElement("name=biological_classification");
    $element->selectLabel('Animal');
    // Submit the form
    $this->driver->getElement("id=edit-submit")->click();
  }

 
}